
<style media="screen">

    .nav {
      overflow: visible;
      padding: 0.1rem;
    }
  
    #search {
      float: right;
      position: relative;
      bottom: 0.2rem;
      padding: 0.5rem 1rem;
      width: 15rem;
      border: 1px solid lightgray;
    }
  
    #search-results {
      /* absolute with respect to its parent which is whichever element that uses this*/
      position: absolute;
      background: white;
      box-shadow: 1px 1px 5px rgba(0,0,0,0.35);
      right: 0px;
    }
  
    #search-results a {
      display: block;
      border-bottom: 1px solid lightgray;
      width: 12rem;
      padding: 0.5rem;
      font-weight: bold;
    }
  
    #search-results a:hover {
      background-color: dodgerblue;
      color: white;
    }

    #search-results.hide {
      display: none;
    }

  
  
  </style>
  
  <input type="text" id="search" placeholder="Search">
  <div id="search-results" class="hide"></div>
  <!-- <div id="test"></div> -->
  
  <script src="https://unpkg.com/lunr/lunr.js"></script>
  <script>
  
    const search = document.getElementById('search');
    const results = document.getElementById('search-results');
    //const test = document.getElementById('test');
  
    // Show results only on focus
    search.addEventListener( 'focus', e => {
      console.log('on focus');
      results.classList.remove('hide');
    })
    // moving away
    search.addEventListener( 'blur', e => {
        console.log('on blur');
        results.classList.add('hide');
      })
  
    // Add results to HTML
    search.addEventListener( 'keyup', function() {
      // clear the search results first
      results.innerHTML = '';
      // test.innerHTML = '';
      // this refers to the search element
      if( !this.value ) return
      // Perform search from input value
      let lunrResults = window.idx.search(this.value);
      lunrResults.forEach( page => {
        // Get refs
        //console.log(page)
        let pageMeta = page.ref.split('||')
        let pageLink = document.createElement('a')
        pageLink.innerText = pageMeta[0];
        pageLink.href = pageMeta[1];
        // mousedown is
        pageLink.addEventListener('mousedown',()=>{
          
          window.location.href = pageMeta[1];
        })
        results.appendChild(pageLink);

        //test.appendChild(pageLink)
        //console.log('results ', results)
      })
    })
  
    // Fetch search index as soon as the page loads
    fetch( '/index.json' ).then( res => {
  
      // Parse JSON
      res.json().then( searchIndex => {
        
        // Build Lunr index
        window.idx = lunr(function () {
  
          // Define Lunr fields and refs
          this.ref('meta')
          this.field('title')
          this.field('content')
  
          searchIndex.forEach( page => {
            this.add(page)} )
        })
  
      })
    })
  
  </script>
  